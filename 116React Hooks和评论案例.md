# React Hooks

- React Hooks ä»‹ç» 
- React Hooks åŸºç¡€

## React Hooks ä»‹ç»

1. Hooks æ˜¯ä»€ä¹ˆ
2. ä¸ºä»€ä¹ˆè¦æœ‰ Hooks

### Hooks æ˜¯ä»€ä¹ˆ

- `Hooks`ï¼šé’©å­ã€é’“é’©ã€é’©ä½
- `Hooks` æ˜¯ **React v16.8** ä¸­çš„æ–°å¢åŠŸèƒ½
- ä½œç”¨ï¼šä¸º**å‡½æ•°ç»„ä»¶**æä¾›çŠ¶æ€ã€ç”Ÿå‘½å‘¨æœŸç­‰åŸæœ¬ class ç»„ä»¶ä¸­æä¾›çš„ React åŠŸèƒ½
  - å¯ä»¥ç†è§£ä¸ºé€šè¿‡ Hooks ä¸ºå‡½æ•°ç»„ä»¶é’©å…¥ class ç»„ä»¶çš„ç‰¹æ€§
- æ³¨æ„ï¼š**Hooks åªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨**ï¼Œè‡ªæ­¤ï¼Œå‡½æ•°ç»„ä»¶æˆä¸º React çš„æ–°å® å„¿

React v16.8 ç‰ˆæœ¬å‰åï¼Œç»„ä»¶å¼€å‘æ¨¡å¼çš„å¯¹æ¯”ï¼š

- React v16.8 ä»¥å‰ï¼š class ç»„ä»¶(æä¾›çŠ¶æ€) + å‡½æ•°ç»„ä»¶(å±•ç¤ºå†…å®¹)
- React v16.8 åŠå…¶ä»¥åï¼š
  1. class ç»„ä»¶(æä¾›çŠ¶æ€) + å‡½æ•°ç»„ä»¶(å±•ç¤ºå†…å®¹)
  2. Hooks(æä¾›çŠ¶æ€) + å‡½æ•°ç»„ä»¶(å±•ç¤ºå†…å®¹)
  3. æ··ç”¨ä»¥ä¸Šä¸¤ç§æ–¹å¼ï¼šéƒ¨åˆ†åŠŸèƒ½ç”¨ class ç»„ä»¶ï¼Œéƒ¨åˆ†åŠŸèƒ½ç”¨ Hooks+å‡½æ•°ç»„ä»¶

æ³¨æ„1ï¼šè™½ç„¶æœ‰äº† Hooksï¼Œä½† React å®˜æ–¹å¹¶æ²¡æœ‰è®¡åˆ’ä» React åº“ä¸­ç§»é™¤ classã€‚
æ³¨æ„2ï¼šæœ‰äº† Hooks ä»¥åï¼Œä¸èƒ½å†æŠŠ**å‡½æ•°ç»„ä»¶**ç§°ä¸ºæ— çŠ¶æ€ç»„ä»¶äº†ï¼Œå› ä¸º Hooks ä¸ºå‡½æ•°ç»„ä»¶æä¾›äº†çŠ¶æ€ã€‚

### ä¸ºä»€ä¹ˆè¦æœ‰ Hooks

ä¸¤ä¸ªè§’åº¦ï¼š1 ç»„ä»¶çš„çŠ¶æ€é€»è¾‘å¤ç”¨ 2 class ç»„ä»¶è‡ªèº«çš„é—®é¢˜

1. class ç»„ä»¶è‡ªèº«çš„é—®é¢˜ï¼š
   - é€‰æ‹©ï¼šå‡½æ•°ç»„ä»¶å’Œ class ç»„ä»¶ä¹‹é—´çš„åŒºåˆ«ä»¥åŠä½¿ç”¨å“ªç§ç»„ä»¶æ›´åˆé€‚
   - éœ€è¦ç†è§£ class ä¸­çš„ this æ˜¯å¦‚ä½•å·¥ä½œçš„
   - ç›¸äº’å…³è”ä¸”éœ€è¦å¯¹ç…§ä¿®æ”¹çš„ä»£ç è¢«æ‹†åˆ†åˆ°ä¸åŒç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­
     - componentDidMount ->  window.addEventListener('resize', this.fn)
     - componentWillUnmount -> window.addEventListener('resize', this.fn)
   - ç›¸æ¯”äºå‡½æ•°ç»„ä»¶æ¥è¯´ï¼Œä¸åˆ©äºä»£ç å‹ç¼©å’Œä¼˜åŒ–ï¼Œä¹Ÿä¸åˆ©äº TS çš„ç±»å‹æ¨å¯¼

æ­£æ˜¯ç”±äº React åŸæ¥å­˜åœ¨çš„è¿™äº›é—®é¢˜ï¼Œæ‰æœ‰äº† Hooks æ¥è§£å†³è¿™äº›é—®é¢˜

### å‰é¢å­¦ä¹ çš„ React çŸ¥è¯†æ˜¯æœ‰ç”¨çš„

class ç»„ä»¶ç›¸å…³çš„ API ä¸ç”¨äº†ï¼Œæ¯”å¦‚ï¼š

- `class Hello extends Component`
- `componentDidMount`ã€`componentDidUpdate`ã€`componentWillUnmount`
- `this` ç›¸å…³çš„ç”¨æ³•

åŸæ¥å­¦ä¹ çš„å†…å®¹è¿˜æ˜¯è¦ç”¨çš„ï¼Œæ¯”å¦‚ï¼š

- JSXï¼š`{}`ã€`onClick={handleClick}`ã€æ¡ä»¶æ¸²æŸ“ã€åˆ—è¡¨æ¸²æŸ“ã€æ ·å¼å¤„ç†ç­‰
- ç»„ä»¶ï¼šå‡½æ•°ç»„ä»¶ã€ç»„ä»¶é€šè®¯
- è·¯ç”±
- React å¼€å‘ç†å¿µï¼š`å•å‘æ•°æ®æµ`ã€`çŠ¶æ€æå‡` ç­‰
- è§£å†³é—®é¢˜çš„æ€è·¯ã€æŠ€å·§ã€å¸¸è§é”™è¯¯çš„åˆ†æç­‰

## React Hooks åŸºç¡€

1. æ¦‚è¿°
2. useState
3. useEffect

## useState Hook

### æ¦‚è¿°

é—®é¢˜ï¼šHook æ˜¯ä»€ä¹ˆ? ä¸€ä¸ª Hook å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼Œè®©ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­è·å–çŠ¶æ€ç­‰ React ç‰¹æ€§
ä½¿ç”¨æ¨¡å¼ï¼šå‡½æ•°ç»„ä»¶ + Hooks
ç‰¹ç‚¹ï¼šä»åç§°ä¸Šçœ‹ï¼ŒHook éƒ½ä»¥ use å¼€å¤´

### useState Hook çš„åŸºæœ¬ä½¿ç”¨

- ä½¿ç”¨åœºæ™¯ï¼šå½“ä½ æƒ³è¦åœ¨**å‡½æ•°ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ç»„ä»¶çŠ¶æ€æ—¶**ï¼Œå°±è¦ä½¿ç”¨ **useState** Hook äº†
- ä½œç”¨ï¼šä¸ºå‡½æ•°ç»„ä»¶æä¾›çŠ¶æ€ï¼ˆstateï¼‰
- ä½¿ç”¨æ­¥éª¤ï¼š
  1. å¯¼å…¥ `useState` å‡½æ•°
  2. è°ƒç”¨ `useState` å‡½æ•°ï¼Œå¹¶ä¼ å…¥çŠ¶æ€çš„åˆå§‹å€¼
  3. ä» `useState` å‡½æ•°çš„è¿”å›å€¼ä¸­ï¼Œæ‹¿åˆ°çŠ¶æ€å’Œä¿®æ”¹çŠ¶æ€çš„å‡½æ•°
  4. åœ¨ JSX ä¸­å±•ç¤ºçŠ¶æ€
  5. åœ¨æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ä¸­è°ƒç”¨ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ï¼Œæ¥æ›´æ–°çŠ¶æ€

```js
import { useState } from 'react'

const Count = () => {
  // è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„
  const stateArray = useState(0)

  // çŠ¶æ€å€¼ -> 0
  const state = stateArray[0]
  // ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°
  const setState = stateArray[1]

  return (
    <div>
      {/* å±•ç¤ºçŠ¶æ€å€¼ */}
      <h1>useState Hook -> {state}</h1>
      {/* ç‚¹å‡»æŒ‰é’®ï¼Œè®©çŠ¶æ€å€¼ +1 */}
      <button onClick={() => setState(state + 1)}>+1</button>
    </div>
  )
}
```

- å‚æ•°ï¼š**çŠ¶æ€åˆå§‹å€¼**ã€‚æ¯”å¦‚ï¼Œä¼ å…¥ 0 è¡¨ç¤ºè¯¥çŠ¶æ€çš„åˆå§‹å€¼ä¸º 0
  - æ³¨æ„ï¼šæ­¤å¤„çš„çŠ¶æ€å¯ä»¥æ˜¯ä»»æ„å€¼ï¼ˆæ¯”å¦‚ï¼Œæ•°å€¼ã€å­—ç¬¦ä¸²ç­‰ï¼‰ï¼Œè€Œ class ç»„ä»¶ä¸­çš„ state å¿…é¡»æ˜¯å¯¹è±¡
- è¿”å›å€¼ï¼šæ•°ç»„ï¼ŒåŒ…å«ä¸¤ä¸ªå€¼ï¼š1 çŠ¶æ€å€¼ï¼ˆstateï¼‰ 2 ä¿®æ”¹è¯¥çŠ¶æ€çš„å‡½æ•°ï¼ˆsetStateï¼‰

### ä½¿ç”¨æ•°ç»„è§£æ„ç®€åŒ–

æ¯”å¦‚ï¼Œè¦è·å–æ•°ç»„ä¸­çš„å…ƒç´ ï¼š

1. åŸå§‹æ–¹å¼ï¼šç´¢å¼•è®¿é—®

```js
const arr = ['aaa', 'bbb']

const a = arr[0]  // è·å–ç´¢å¼•ä¸º 0 çš„å…ƒç´ 
const b = arr[1]  // è·å–ç´¢å¼•ä¸º 1 çš„å…ƒç´ 
```

2. ç®€åŒ–æ–¹å¼ï¼šæ•°ç»„è§£æ„
   - ç›¸å½“äºåˆ›å»ºäº†ä¸¤ä¸ªå˜é‡ï¼ˆå¯ä»¥æ˜¯ä»»æ„çš„å˜é‡åç§°ï¼‰åˆ†åˆ«è·å–åˆ°å¯¹åº”ç´¢å¼•çš„æ•°ç»„å…ƒç´ 

```js
const arr = ['aaa', 'bbb']

const [a, b] = arr
// a => arr[0]
// b => arr[1]

const [state, setState] = arr
```

- ä½¿ç”¨æ•°ç»„è§£æ„ç®€åŒ– `useState` çš„ä½¿ç”¨
  - çº¦å®šï¼š**ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°åç§°ä»¥ set å¼€å¤´ï¼Œåé¢è·Ÿä¸ŠçŠ¶æ€çš„åç§°**

```js
// è§£æ„å‡ºæ¥çš„åç§°å¯ä»¥æ˜¯ä»»æ„åç§°

const [state, setState] = useState(0)
const [age, setAge] = useState(0)
const [count, setCount] = useState(0)
```

### çŠ¶æ€çš„è¯»å–å’Œä¿®æ”¹

çŠ¶æ€çš„ä½¿ç”¨ï¼š1 è¯»å–çŠ¶æ€ 2 ä¿®æ”¹çŠ¶æ€

1. è¯»å–çŠ¶æ€ï¼šè¯¥æ–¹å¼æä¾›çš„çŠ¶æ€ï¼Œæ˜¯å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…çš„ä»»æ„ä½ç½®ä½¿ç”¨

2. ä¿®æ”¹çŠ¶æ€ï¼š
  - `setCount(newValue)` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°è¡¨ç¤ºï¼š**æ–°çš„çŠ¶æ€å€¼**
  - è°ƒç”¨è¯¥å‡½æ•°åï¼Œå°†**ä½¿ç”¨æ–°çš„çŠ¶æ€å€¼`æ›¿æ¢`æ—§å€¼**
  - ä¿®æ”¹çŠ¶æ€åï¼Œå› ä¸ºçŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä»¥ï¼Œè¯¥ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“

### ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹

å‡½æ•°ç»„ä»¶ä½¿ç”¨ **useState** hook åçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä»¥åŠçŠ¶æ€å€¼çš„å˜åŒ–ï¼š 

- ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼š
  1. ä»å¤´å¼€å§‹æ‰§è¡Œè¯¥ç»„ä»¶ä¸­çš„ä»£ç é€»è¾‘
  2. è°ƒç”¨ `useState(0)` å°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºçŠ¶æ€åˆå§‹å€¼ï¼Œå³ï¼š0
  3. æ¸²æŸ“ç»„ä»¶ï¼Œæ­¤æ—¶ï¼Œè·å–åˆ°çš„çŠ¶æ€ count å€¼ä¸ºï¼š 0

- ç»„ä»¶ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼š
  1. ç‚¹å‡»æŒ‰é’®ï¼Œè°ƒç”¨ `setCount(count + 1)` ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºçŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥ï¼Œè¯¥ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“
  2. ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¼šå†æ¬¡æ‰§è¡Œè¯¥ç»„ä»¶ä¸­çš„ä»£ç é€»è¾‘
  3. å†æ¬¡è°ƒç”¨ `useState(0)`ï¼Œæ­¤æ—¶ **React å†…éƒ¨ä¼šæ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€å€¼è€Œéåˆå§‹å€¼**ï¼Œæ¯”å¦‚ï¼Œè¯¥æ¡ˆä¾‹ä¸­æœ€æ–°çš„çŠ¶æ€å€¼ä¸º 1
  4. å†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œæ­¤æ—¶ï¼Œè·å–åˆ°çš„çŠ¶æ€ count å€¼ä¸ºï¼š1

æ³¨æ„ï¼š**useState çš„åˆå§‹å€¼(å‚æ•°)åªä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ç”Ÿæ•ˆ**ã€‚ 

ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥åçš„æ¯æ¬¡æ¸²æŸ“ï¼ŒuseState è·å–åˆ°éƒ½æ˜¯æœ€æ–°çš„çŠ¶æ€å€¼ã€‚React ç»„ä»¶ä¼šè®°ä½æ¯æ¬¡æœ€æ–°çš„çŠ¶æ€å€¼!

### ä¸ºå‡½æ•°ç»„ä»¶æ·»åŠ å¤šä¸ªçŠ¶æ€

é—®é¢˜ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°ç»„ä»¶éœ€è¦å¤šä¸ªçŠ¶æ€ï¼Œè¯¥å¦‚ä½•å¤„ç†?
å›ç­”ï¼šè°ƒç”¨ `useState` Hook å¤šæ¬¡å³å¯ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ useState Hook å¯ä»¥æä¾›ä¸€ä¸ªçŠ¶æ€ã€‚
æ³¨æ„ï¼šuseState Hook å¤šæ¬¡è°ƒç”¨è¿”å›çš„ [state, setState] ç›¸äº’ä¹‹é—´ï¼Œäº’ä¸å½±å“ã€‚

### hooks çš„ä½¿ç”¨è§„åˆ™

æ³¨æ„ï¼š**React Hooks åªèƒ½ç›´æ¥å‡ºç°åœ¨ å‡½æ•°ç»„ä»¶ ä¸­ï¼Œä¸èƒ½åµŒå¥—åœ¨ if/for/å…¶ä»–å‡½æ•°ä¸­**ï¼

å¦åˆ™å°±ä¼šæŠ¥é”™ï¼šReact Hook "useState" is called conditionally. React Hooks must be called in the exact same order in every component render

React çš„ useState è¿™ä¸ª Hook è¢«æ¡ä»¶æ€§ï¼ˆæ”¾åœ¨ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ä¸­ï¼‰çš„è°ƒç”¨äº†ã€‚

React Hooks å¿…é¡»è¦æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒæŒ‰ç…§**ç›¸åŒçš„é¡ºåº**æ¥è°ƒç”¨æ‰€æœ‰çš„ Hooksã€‚

- ä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„è§„åˆ™ï¼Ÿ å› ä¸º React æ˜¯æŒ‰ç…§ Hooks çš„è°ƒç”¨é¡ºåºæ¥è¯†åˆ«æ¯ä¸€ä¸ª Hookï¼Œå¦‚æœæ¯æ¬¡è°ƒç”¨çš„é¡ºåºä¸åŒï¼Œå¯¼è‡´ React æ— æ³•çŸ¥é“æ˜¯å“ªä¸€ä¸ª Hook

---

## useEffect Hook

1. side effect - å‰¯ä½œç”¨
2. useEffect çš„åŸºæœ¬ä½¿ç”¨
3. useEffect çš„ä¾èµ–
4. useEffect å‘é€è¯·æ±‚

### side effect - å‰¯ä½œç”¨

ä½¿ç”¨åœºæ™¯ï¼šå½“ä½ æƒ³è¦åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œ**å¤„ç†å‰¯ä½œç”¨ï¼ˆside effectï¼‰æ—¶**ï¼Œå°±è¦ä½¿ç”¨ **useEffect** Hook äº†
ä½œç”¨ï¼š**å¤„ç†å‡½æ•°ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰**


é—®é¢˜ï¼šå‰¯ä½œç”¨ï¼ˆside effectï¼‰æ˜¯ä»€ä¹ˆ? 
å›ç­”ï¼šåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æˆ–å…¶ä»–æ“ä½œä¿®æ”¹äº†å…¶å±€éƒ¨ç¯å¢ƒä¹‹å¤–çš„çŠ¶æ€å˜é‡å€¼ï¼Œé‚£ä¹ˆå®ƒå°±è¢«ç§°ä¸ºæœ‰å‰¯ä½œç”¨
ç±»æ¯”ï¼Œå¯¹äº 999 æ„Ÿå†’çµæ„Ÿå†’è¯æ¥è¯´ï¼š

- ï¼ˆ**ä¸»**ï¼‰ä½œç”¨ï¼šç”¨äºæ„Ÿå†’å¼•èµ·çš„å¤´ç—›ï¼Œå‘çƒ­ï¼Œé¼»å¡ï¼Œæµæ¶•ï¼Œå’½ç—›ç­‰ 
- å‰¯ä½œç”¨ï¼šå¯è§å›°å€¦ã€å—œç¡ã€å£æ¸´ã€è™šå¼±æ„Ÿ

ç†è§£ï¼šå‰¯ä½œç”¨æ˜¯ç›¸å¯¹äºä¸»ä½œç”¨æ¥è¯´çš„ï¼Œä¸€ä¸ªåŠŸèƒ½ï¼ˆæ¯”å¦‚ï¼Œå‡½æ•°ï¼‰é™¤äº†ä¸»ä½œç”¨ï¼Œå…¶ä»–çš„ä½œç”¨å°±æ˜¯å‰¯ä½œç”¨
å¯¹äº React ç»„ä»¶æ¥è¯´ï¼Œ**ä¸»ä½œç”¨å°±æ˜¯æ ¹æ®æ•°æ®ï¼ˆstate/propsï¼‰æ¸²æŸ“ UI**ï¼Œé™¤æ­¤ä¹‹å¤–éƒ½æ˜¯å‰¯ä½œç”¨ï¼ˆæ¯”å¦‚ï¼Œæ‰‹åŠ¨ä¿®æ”¹ DOMï¼‰

React ç»„ä»¶çš„å…¬å¼ï¼š**UI = f(state)**

å¸¸è§çš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰ï¼š

- æ•°æ®ï¼ˆAjaxï¼‰è¯·æ±‚ã€æ‰‹åŠ¨ä¿®æ”¹ DOMã€localStorage æ“ä½œç­‰

```js
// ä¸å¸¦å‰¯ä½œç”¨çš„æƒ…å†µï¼š
// è¯¥å‡½æ•°çš„ï¼ˆä¸»ï¼‰ä½œç”¨ï¼šè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ
function fn(a, b) {
  return a + b
}

// å¸¦å‰¯ä½œç”¨çš„æƒ…å†µï¼š
let c = 1
function fn(a, b) {
  // å› ä¸ºæ­¤å¤„ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡å€¼ï¼Œè€Œè¿™ä¸€ç‚¹ä¸æ˜¯è¯¥å‡½æ•°çš„ä¸»ä½œç”¨ï¼Œå› æ­¤ï¼Œå°±æ˜¯ï¼šside effectï¼ˆå‰¯ä½œç”¨ï¼‰
  c = 2
  return a + b
}

// å¸¦å‰¯ä½œç”¨çš„æƒ…å†µï¼š
function fn(a, b) {
  // å› ä¸º console.log ä¼šå¯¼è‡´æ§åˆ¶å°æ‰“å°å†…å®¹ï¼Œæ‰€ä»¥ï¼Œä¹Ÿæ˜¯å¯¹å¤–éƒ¨äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥ï¼Œä¹Ÿæ˜¯ï¼šå‰¯ä½œç”¨
  console.log(a)
  return a + b
}

// æ²¡æœ‰å‰¯ä½œç”¨ï¼š
function fn(obj) {
  return obj.name
}

// æœ‰å‰¯ä½œç”¨ï¼š
function fn(obj) {
  // æ­¤å¤„ç›´æ¥ä¿®æ”¹äº†å‚æ•°çš„å€¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå‰¯ä½œç”¨
  obj.name = 'å¤§é£å“¥'
  return obj.name
}
const o = { name: 'å°é©¬å“¥' }
fn(o)
```

### useEffect çš„åŸºæœ¬ä½¿ç”¨

ä½¿ç”¨åœºæ™¯ï¼šå½“ä½ æƒ³è¦åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå¤„ç†å‰¯ä½œç”¨ï¼ˆside effectï¼‰æ—¶ï¼Œå°±è¦ä½¿ç”¨ useEffect Hook äº†
ä½œç”¨ï¼šå¤„ç†å‡½æ•°ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰
æ³¨æ„ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œå‰¯ä½œç”¨æ˜¯ä¸å¯é¿å…çš„ã€‚å› æ­¤ï¼Œreact ä¸“é—¨æä¾›äº† **useEffect** Hook **æ¥å¤„ç†å‡½æ•°ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨**

```js
import { useEffect } from 'react'

useEffect(function effect() {
  document.title = `å½“å‰å·²ç‚¹å‡» ${count} æ¬¡`
})

useEffect(() => {
  document.title = `å½“å‰å·²ç‚¹å‡» ${count} æ¬¡`
})
```

è§£é‡Šï¼š

- å‚æ•°ï¼šå›è°ƒå‡½æ•°ï¼ˆç§°ä¸º **effect**ï¼‰ï¼Œå°±æ˜¯**åœ¨è¯¥å‡½æ•°ä¸­å†™å‰¯ä½œç”¨ä»£ç **
- æ‰§è¡Œæ—¶æœºï¼šè¯¥ effect ä¼šåœ¨æ¯æ¬¡ç»„ä»¶æ›´æ–°ï¼ˆDOMæ›´æ–°ï¼‰åæ‰§è¡Œ

### useEffect çš„ä¾èµ–

- é—®é¢˜ï¼šå¦‚æœç»„ä»¶ä¸­æœ‰å¦å¤–ä¸€ä¸ªçŠ¶æ€ï¼Œå¦ä¸€ä¸ªçŠ¶æ€æ›´æ–°æ—¶ï¼Œåˆšåˆšçš„ effect å›è°ƒï¼Œä¹Ÿä¼šæ‰§è¡Œ 
- æ€§èƒ½ä¼˜åŒ–ï¼š**è·³è¿‡ä¸å¿…è¦çš„æ‰§è¡Œï¼Œåªåœ¨ count å˜åŒ–æ—¶ï¼Œæ‰æ‰§è¡Œç›¸åº”çš„ effect**

```js
useEffect(() => {
  document.title = `å½“å‰å·²ç‚¹å‡» ${count} æ¬¡`
}, [count])
```

è§£é‡Šï¼š

- ç¬¬äºŒä¸ªå‚æ•°ï¼šå¯é€‰çš„ï¼Œå¯çœç•¥ï¼›ä¹Ÿå¯ä»¥ä¼ ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ å¯ä»¥æˆä¸ºä¾èµ–é¡¹ï¼ˆdepsï¼‰ 
- è¯¥ç¤ºä¾‹ä¸­è¡¨ç¤ºï¼šåªæœ‰å½“ count æ”¹å˜æ—¶ï¼Œæ‰ä¼šé‡æ–°æ‰§è¡Œè¯¥ effect

### useEffect çš„ä¾èµ–æ˜¯ä¸€ä¸ªç©ºæ•°ç»„

useEffect çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ª**ç©ºæ•°ç»„ï¼ˆ[]ï¼‰**ï¼Œè¡¨ç¤ºåªåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“åæ‰§è¡Œ effect
ä½¿ç”¨åœºæ™¯ï¼š1 äº‹ä»¶ç»‘å®š 2 å‘é€è¯·æ±‚è·å–æ•°æ® ç­‰

```js
useEffect(() => {
  const handleResize = () => {}
  window.addEventListener('resize', handleResize)
}, [])
```

è§£é‡Šï¼š

- è¯¥ effect åªä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“åæ‰§è¡Œï¼Œå› æ­¤ï¼Œå¯ä»¥æ‰§è¡Œåƒäº‹ä»¶ç»‘å®šç­‰åªéœ€è¦æ‰§è¡Œä¸€æ¬¡çš„æ“ä½œ
  - æ­¤æ—¶ï¼Œç›¸å½“äº class ç»„ä»¶çš„ componentDidMount é’©å­å‡½æ•°çš„ä½œç”¨
- è·Ÿ useState Hook ä¸€æ ·ï¼Œä¸€ä¸ªç»„ä»¶ä¸­ä¹Ÿå¯ä»¥è°ƒç”¨ useEffect Hook å¤šæ¬¡ 
- æ¨èï¼šä¸€ä¸ª useEffect åªå¤„ç†ä¸€ä¸ªåŠŸèƒ½ï¼Œæœ‰å¤šä¸ªåŠŸèƒ½æ—¶ï¼Œä½¿ç”¨å¤šæ¬¡ useEffect

### æ€»ç»“ useEffect çš„ä½¿ç”¨



```js
// è§¦å‘æ—¶æœºï¼š1 ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¼šæ‰§è¡Œ 2 æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“éƒ½ä¼šå†æ¬¡æ‰§è¡Œ
useEffect(() => {})

// è§¦å‘æ—¶æœºï¼šåªåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œ
// ç›¸å½“äº class ç»„ä»¶é’©å­å‡½æ•°çš„ componentDidMount
useEffect(() => {}, [])

// è§¦å‘æ—¶æœºï¼š1 ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¼šæ‰§è¡Œ 2 å½“ count å˜åŒ–æ—¶ä¼šå†æ¬¡æ‰§è¡Œ
useEffect(() => {}, [count])
```

### ä¸è¦å¯¹ useEffect çš„ä¾èµ–æ’’è°ï¼ï¼ï¼

- useEffect å›è°ƒå‡½æ•°ä¸­ç”¨åˆ°çš„æ•°æ®ï¼ˆæ¯”å¦‚ï¼Œcountï¼‰å°±æ˜¯ä¾èµ–æ•°æ®ï¼Œå°±åº”è¯¥å‡ºç°åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­
- å¦‚æœ useEffect å›è°ƒå‡½æ•°ä¸­ç”¨åˆ°äº†æŸä¸ªæ•°æ®ï¼Œä½†æ˜¯ï¼Œæ²¡æœ‰å‡ºç°åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­ï¼Œå°±ä¼šå¯¼è‡´ä¸€äº› Bug å‡ºç°ï¼
- æ‰€ä»¥ï¼Œä¸è¦å¯¹ useEffect çš„ä¾èµ–æ’’è°

```js
// useEffect å›è°ƒä¸­ä¾èµ–ä»€ä¹ˆæ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å°±ä¸€å®šè¦å‡ºç°åœ¨ ä¾èµ–æ•°ç»„ä¸­
// å¦åˆ™ï¼Œå°±ä¼šå‡ºç°ä¸æˆ‘ä»¬çš„é¢„æœŸä¸åŒçš„è¡¨ç°ï¼Œä¹Ÿå°±æ˜¯å‡º Bug ï¼ï¼ï¼
// æ¯”å¦‚ï¼Œæ­¤å¤„çš„å›è°ƒå‡½æ•°ä¸­ç”¨åˆ°äº† countï¼Œé‚£ä¹ˆï¼Œcount å°±æ˜¯å½“å‰çš„ä¾èµ–ï¼Œ
//      å°±åº”è¯¥åœ¨ä¾èµ–æ•°ç»„ä¸­ï¼Œæä¾› countï¼Œå¦‚æœä¸æä¾›ï¼Œä»£ç å°±å‡º Bug äº†ï¼ï¼ï¼

// æ²¡æœ‰é—®é¢˜ï¼š
// useEffect(() => {
//   console.log('effect')
//   // å‰¯ä½œç”¨
//   document.title = `Countï¼š${count}`
// }, [count])

// æœ‰é—®é¢˜ï¼š
// å¦‚æœå®‰è£…äº† ESLint æ’ä»¶ï¼Œåœ¨ useEffect ä¾èµ–é¡¹æ•°ç»„çš„ä»£ç ä½ç½®å°±ä¼šæœ‰é»„è‰²çš„æ³¢æµªçº¿è­¦å‘Š
// çœ‹åˆ°è¯¥è­¦å‘Šï¼Œå°±æŠŠé¼ æ ‡æ”¾åœ¨ è­¦å‘Š ä¸Šé¢ï¼Œæ ¹æ®æç¤ºï¼Œæ¥è¡¥å…¨ä¾èµ–ï¼ï¼ï¼
useEffect(() => {
  console.log('effect')
  // å‰¯ä½œç”¨
  document.title = `Countï¼š${count}`
}, []) // æ­¤å¤„çš„çš„æ•°ç»„ä¼šæœ‰ä¸€ä¸ªé»„è‰²çš„æ³¢æµªçº¿è­¦å‘Š
```



---



### useEffect ç»„ä»¶å¸è½½æ—¶

é—®é¢˜ï¼šå¦‚ä½•åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œè§£ç»‘äº‹ä»¶ï¼Ÿæ­¤æ—¶ï¼Œå°±ç”¨åˆ° effect çš„è¿”å›å€¼äº†

```js
useEffect(() => {
  const handleResize = () => {}
  window.addEventListener('resize', handleResize)
  
  // è¿™ä¸ªè¿”å›çš„å‡½æ•°ï¼Œä¼šåœ¨è¯¥ç»„ä»¶å¸è½½æ—¶æ¥æ‰§è¡Œ
  // å› æ­¤ï¼Œå¯ä»¥å»æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œæ¯”å¦‚ï¼Œè§£ç»‘ window çš„äº‹ä»¶ã€æ¸…ç†å®šæ—¶å™¨ ç­‰
  return () => window.removeEventListener('resize', handleResize)
}, [])
```

è§£é‡Šï¼š

- effect çš„è¿”å›å€¼ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œå¯çœç•¥ã€‚ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ª**æ¸…ç†å‡½æ•°**ï¼Œç”¨æ¥æ‰§è¡Œäº‹ä»¶è§£ç»‘ç­‰æ¸…ç†æ“ä½œ
- æ¸…ç†å‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼š1**ã€ç©ºæ•°ç»„æ²¡æœ‰ä¾èµ–ã€‘ç»„ä»¶å¸è½½æ—¶**
  - æ­¤æ—¶ï¼Œç›¸å½“äº class ç»„ä»¶çš„ `componentWillUnmount` é’©å­å‡½æ•°çš„ä½œç”¨
- æ¨èï¼šä¸€ä¸ª useEffect åªå¤„ç†ä¸€ä¸ªåŠŸèƒ½ï¼Œæœ‰å¤šä¸ªåŠŸèƒ½æ—¶ï¼Œä½¿ç”¨å¤šæ¬¡ useEffect 
- ä¼˜åŠ¿ï¼šæ ¹æ®ä¸šåŠ¡é€»è¾‘æ¥æ‹†åˆ†ï¼Œç›¸åŒåŠŸèƒ½çš„ä¸šåŠ¡é€»è¾‘æ”¾åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯æ ¹æ®ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åç§°æ¥æ‹†åˆ†ä»£ç  
- ç¼–å†™ä»£ç æ—¶ï¼Œå…³æ³¨ç‚¹é›†ä¸­ï¼›è€Œä¸æ˜¯ä¸Šä¸‹ç¿»æ»šæ¥æŸ¥çœ‹ä»£ç 

### å°†äº‹ä»¶å¤„ç†ç¨‹åºæ”¾åœ¨ useEffect å†…éƒ¨

- å‚è€ƒï¼š[useEffect å®Œå…¨ä½¿ç”¨æŒ‡å—](https://www.jianshu.com/p/ab432b6344f6)

```js
// 1 å°† resize äº‹ä»¶å¤„ç†ç¨‹åºæ”¾åœ¨ effect å›è°ƒä¸­ï¼Œå½“å‰è¿™ä¸ªä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„
useEffect(() => {
  const handleResize = () => {
    console.log('window çª—å£å¤§å°æ”¹å˜äº†')
  }
  window.addEventListener('resize', handleResize)

  return () => {
    window.removeEventListener('resize', handleResize)
  }
}, [])

// 2 å°† resize äº‹ä»¶å¤„ç†ç¨‹åºæ‹¿åˆ° useEffect çš„å¤–éƒ¨ï¼Œå½“å‰è¿™ä¸ªä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„
const handleResize = () => {
  console.log('window çª—å£å¤§å°æ”¹å˜äº†')
}

useEffect(() => {
  window.addEventListener('resize', handleResize)

  return () => {
    window.removeEventListener('resize', handleResize)
  }
}, [])

// 3 æœ‰ä¾èµ–é¡¹çš„æƒ…å†µï¼š
useEffect(() => {
  // resize äº‹ä»¶çš„å¤„ç†ç¨‹åº
  const handleResize = () => {
    console.log('window çª—å£å¤§å°æ”¹å˜äº†', count)
  }

  window.addEventListener('resize', handleResize)

  return () => {
    window.removeEventListener('resize', handleResize)
  }
}, [count])


// æ³¨æ„ï¼šæ­¤å¤„çš„ä»£ç ï¼Œä¼šç»™ä¸€äº›è­¦å‘Šï¼ï¼ï¼ ä¸è¦æŒ‰ç…§è¿™ç§æ–¹å¼å†™ä»£ç ï¼ï¼ï¼
// 4 å¦‚æœå°† handleResize æ”¾åˆ°äº† useEffect å¤–éƒ¨ï¼ŒReact ä¼šç»™ä»¥è­¦å‘Šï¼š
//   è¦ä¹ˆå°† handleResize æ”¾åˆ° useEffect ä¸­
//   è¦ä¹ˆä½¿ç”¨ useCallback è¿™ä¸ª hook æ¥åŒ…è£¹ handleResize
// resize äº‹ä»¶çš„å¤„ç†ç¨‹åº
const handleResize = () => {
  console.log('window çª—å£å¤§å°æ”¹å˜äº†', count)
}
useEffect(() => {
  console.log('useeffect æ‰§è¡Œäº†')
  window.addEventListener('resize', handleResize)

  return () => {
    window.removeEventListener('resize', handleResize)
  }
}, [handleResize])

// æ€»ç»“ä»¥ä¸Šå‡ ç§æƒ…å†µï¼Œæ¨èï¼šåœ¨ç»™ window ç»‘å®šäº‹ä»¶æ—¶ï¼Œå°† äº‹ä»¶å¤„ç†ç¨‹åºæ”¾åœ¨ useEffect å†…éƒ¨ã€‚
```



### useEffect å‘é€è¯·æ±‚

åœ¨ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ useEffect Hook å‘é€è¯·æ±‚è·å–æ•°æ®ï¼ˆside effectï¼‰ï¼š

```js
useEffect(() => {
  const loadData = async () => {}
  loadData()
}, [])
```

è§£é‡Šï¼š

- æ³¨æ„ï¼š**effect åªèƒ½æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ async**
- å› ä¸º effect çš„è¿”å›å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼ŒReact ä¼šåœ¨ç»„ä»¶å¸è½½æˆ–è€… effect çš„ä¾èµ–é¡¹å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ 
- ä½†å¦‚æœ effect æ˜¯ async çš„ï¼Œæ­¤æ—¶è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ã€‚è¿™æ ·çš„è¯ï¼Œå°±æ— æ³•ä¿è¯æ¸…ç†å‡½æ•°è¢«ç«‹å³è°ƒç”¨
- å¦‚æœå»¶è¿Ÿè°ƒç”¨æ¸…ç†å‡½æ•°ï¼Œä¹Ÿå°±æ²¡æœ‰æœºä¼šå¿½ç•¥è¿‡æ—¶çš„è¯·æ±‚ç»“æœæˆ–å–æ¶ˆè¯·æ±‚
- **ä¸ºäº†ä½¿ç”¨ async/await è¯­æ³•ï¼Œå¯ä»¥åœ¨ effect å†…éƒ¨åˆ›å»º async å‡½æ•°ï¼Œå¹¶è°ƒç”¨**

```js
// é”™è¯¯æ¼”ç¤ºï¼š

// ä¸è¦ç»™ effect æ·»åŠ  async
useEffect(async () => {}, [])
```

```js
// https://github.com/facebook/react/issues/14326#issuecomment-441680293

useEffect(() => {
  // æ˜¯å¦å–æ¶ˆæœ¬æ¬¡è¯·æ±‚
  let didCancel = false

  async function fetchMyAPI() {
    let url = 'http://something/' + productId
    let config = {}
    const response = await myFetch(url)
    // å¦‚æœå¼€å¯å…¶ä»–è¯·æ±‚ï¼Œå°±å¿½ç•¥æœ¬æ¬¡ï¼ˆè¿‡æ—¶ï¼‰çš„è¯·æ±‚ç»“æœ
    if (!didCancel) {
      console.log(response)
    }
  }

  fetchMyAPI()
  return () => { didCancel = true } // å–æ¶ˆæœ¬æ¬¡è¯·æ±‚
}, [productId])
```

## è¯„è®ºæ¡ˆä¾‹

### æ¸²æŸ“åˆ—è¡¨æ•°æ®

1. å‡†å¤‡å¥½åˆ—è¡¨æ•°æ®ï¼ˆæ ¹æ®é¡µé¢åˆ†æå¾—åˆ°ï¼‰
2. å°†å‡†å¤‡å¥½çš„åˆ—è¡¨æ•°æ®ï¼Œæ·»åŠ ä¸ºç»„ä»¶çš„çŠ¶æ€
3. å°†åˆ—è¡¨æ•°æ®ï¼Œä¼ é€’ç»™ CommentList å­ç»„ä»¶
4. CommentList å­ç»„ä»¶æ¥æ”¶è¯„è®ºåˆ—è¡¨æ•°æ®ï¼Œè¿›è¡Œåˆ—è¡¨æ¸²æŸ“

```js
// è¯„è®ºåˆ—è¡¨æ•°æ®çš„åˆå§‹å€¼
const comments = [
  {
    id: 1,
    // è¯„è®ºå†…å®¹
    content: 'ä¸€å¬å°±æ‡‚ï¼ğŸ‘',
    // è¯„è®ºåˆ›å»ºæ—¶é—´
    createTime: new Date('2021-1-30 21:39:35'),
    // ç‚¹èµæ•°
    like: 98,
    // æ˜¯å¦ç‚¹èµ
    isLike: false,
    // æ˜¯å¦è¸©
    isHate: false
  },
  {
    id: 2,
    // è¯„è®ºå†…å®¹
    content: 'ä¸€å¬å°±æ‡‚ï¼ğŸ‘',
    // è¯„è®ºåˆ›å»ºæ—¶é—´
    createTime: new Date('2021-1-30 21:39:35'),
    // ç‚¹èµæ•°
    like: 98,
    // æ˜¯å¦ç‚¹èµ
    isLike: false,
    // æ˜¯å¦è¸©
    isHate: false
  }
]
```

- JSX æ¸²æŸ“å¯¹è±¡ä¼šæŠ¥é”™ï¼š

```js
// JSX ä¸­ç›´æ¥åœ¨ç»“æ„ä¸­æ¸²æŸ“ä¸€ä¸ªå¯¹è±¡å€¼çš„æ—¶å€™ï¼Œä»£ç ä¼šæŠ¥é”™ï¼š
// é”™è¯¯ä¿¡æ¯ï¼š
Objects are not valid as a React child (found: Sat Jan 30 2021 21:39:35 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)). 
If you meant to render a collection of children, use an array instead.

å¯¹è±¡ä¸æ˜¯åˆæ³•çš„ React Child => å¯¹è±¡ä¸èƒ½åœ¨ JSX ä¸­ç›´æ¥æ¸²æŸ“ï¼

// ä»¥ä¸‹ä»£ç å°±ä¼šæŠ¥ä¸Šé¢çš„é”™è¯¯ï¼š
const obj = {}
<div>{obj}</div>

// è¯¥ä»£ç ä¹Ÿä¼šæŠ¥é”™ï¼Œå› ä¸º date ä¹Ÿæ˜¯å¯¹è±¡
const date = new Date()
<div>{date}</div>
```

### åœ¨ç»“æ„ä¸­æ¸²æŸ“æ—¥æœŸ

```js
// å› æ­¤ï¼Œå¯¹äº æ—¥æœŸå¯¹è±¡ ä¸èƒ½ç›´æ¥æ¸²æŸ“çš„é—®é¢˜ï¼Œå¯ä»¥å°† æ—¥æœŸå¯¹è±¡ è½¬åŒ–ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼Œå³å¯
// æ­¤å¤„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ dayjs ç¬¬ä¸‰æ–¹åº“ï¼Œæ¥å¸®æˆ‘ä»¬æ ¼å¼åŒ–æ—¥æœŸ

// 1 å®‰è£… dayjsï¼š yarn add dayjs
// 2 åœ¨ CommentList ç»„ä»¶ä¸­å¯¼å…¥ dayjs
import dayjs from 'dayjs'
// 3 åœ¨ map éå†æ•°æ®æ—¶ï¼Œæ ¼å¼åŒ–æ—¥æœŸ
const date = dayjs(createTime).format('YYYY-MM-DD HH:mm:ss')
// 4 åœ¨ç»“æ„ä¸­ï¼Œæ¸²æŸ“ date å­—ç¬¦ä¸²å³å¯
<span className="time">{date}</span>
```

### å‘è¡¨è¯„è®º - è·å–textareaçš„å€¼

æ€è·¯ï¼šé€šè¿‡å—æ§ç»„ä»¶çš„æ–¹å¼æ¥è·å–textareaçš„å€¼

1. å…ˆé€šè¿‡ `useState` hook æ¥æä¾›ä¸€ä¸ªçŠ¶æ€ï¼ŒçŠ¶æ€åˆå§‹å€¼ä¸ºï¼š`''`
2. ä¸º textarea æä¾› `onChange` å’Œ `value`
3. `value` å°±æ˜¯æˆ‘ä»¬æä¾›çš„çŠ¶æ€å€¼
4. `onChange` ä¸­ï¼Œé€šè¿‡äº‹ä»¶å¯¹è±¡æ¥è·å–æ–‡æœ¬æ¡†çš„æœ€æ–°å€¼
5. ä¼ é€’ç»™ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ï¼Œæ¥æ›´æ–°çŠ¶æ€å³å¯

```js
// æä¾›æ–‡æœ¬æ¡†çš„å€¼ çŠ¶æ€
  const [value, setValue] = useState('')

  // textarea çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const onChange = e => {
    setValue(e.target.value)
  }
  
  <textarea
    cols="80"
    rows="5"
    placeholder="å‘æ¡å‹å–„çš„è¯„è®º"
    className="ipt-txt"
    value={value}
    onChange={onChange}
  />
```

### å‘è¡¨è¯„è®º - æ›´æ–°çŠ¶æ€

1. ç»™å‘è¡¨è¯„è®ºæŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶
2. åœ¨ç‚¹å‡»äº‹ä»¶ä¸­ï¼Œæ‹¿åˆ° textarea çš„å€¼
3. å°† textarea çš„å€¼ä¼ é€’ç»™çˆ¶ç»„ä»¶ã€å­ -> çˆ¶ ç»„ä»¶é€šè®¯ï¼Œçˆ¶ç»„ä»¶æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œä¼ é€’ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶è°ƒç”¨å¹¶ä¼ é€’æ•°æ®ã€‘
4. çˆ¶ç»„ä»¶æ‹¿åˆ°å­ç»„ä»¶ä¸­ä¼ é€’è¿‡æ¥çš„è¯„è®ºå†…å®¹
5. å°†è¯„è®ºæ•°æ®æ·»åŠ åˆ° list æ•°æ®ä¸­ï¼Œç„¶åæ›´æ–°çŠ¶æ€

```js
// Comments çˆ¶ç»„ä»¶
// ä½¿ç”¨ comments æ¥ä½œä¸ºè¯¥çŠ¶æ€çš„åˆå§‹å€¼
// æ³¨æ„ï¼šsetList æ›´æ–°çŠ¶æ€çš„å‡½æ•°ï¼Œä¼šç”¨æ–°å€¼ æ›¿æ¢ æ—§å€¼
const [list, setList] = useState(comments)

// å‘å¸ƒè¯„è®ºçš„å‡½æ•°
const onAdd = content => {
  // åˆ›å»ºæ–°çš„çŠ¶æ€
  const id = list.length === 0 ? 1 : list[list.length - 1].id + 1
  const newList = [
    ...list,
    {
      id,
      content,
      // è¯„è®ºåˆ›å»ºæ—¶é—´
      createTime: new Date(),
      // ç‚¹èµæ•°
      like: 0,
      // æ˜¯å¦ç‚¹èµ
      isLike: false,
      // æ˜¯å¦è¸©
      isHate: false
    }
  ]
  // æ›´æ–°çŠ¶æ€
  setList(newList)
}

{/* å‘è¡¨è¯„è®ºç»„ä»¶ */}
<CommentSend onAdd={onAdd} />


// CommentSend å­ç»„ä»¶
const CommentSend = ({ onAdd }) => {
  // æä¾›æ–‡æœ¬æ¡†çš„å€¼ çŠ¶æ€
  const [value, setValue] = useState('')

  // textarea çš„äº‹ä»¶å¤„ç†ç¨‹åº
  const onChange = e => {
    setValue(e.target.value)
  }

  // å‘è¡¨è¯„è®º
  const onAddComment = () => {
    if (value.trim() === '') return
    // å°† textarea çš„å€¼ä¼ é€’ç»™çˆ¶ç»„ä»¶
    onAdd(value)
    
    setValue('')
  }
  
	render() {
    return (
      // çœç•¥å…¶ä»–ç»“æ„
    	<div className="textarea-container">
        <textarea
          cols="80"
          rows="5"
          placeholder="å‘æ¡å‹å–„çš„è¯„è®º"
          className="ipt-txt"
          value={value}
          onChange={onChange}
        />

        <button className="comment-submit" onClick={onAddComment}>
          å‘è¡¨è¯„è®º
        </button>
      </div>
			// çœç•¥å…¶ä»–ç»“æ„
    )
  }
}
```

### ç‚¹èµå’Œè¸©

ä¸¤ç§å®ç°æ–¹å¼ï¼š

1. åˆ†åˆ«å•ç‹¬å¤„ç† ç‚¹èµ å’Œ è¸©ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸¤ä¸ªäº‹ä»¶å¤„ç†ç¨‹åº
2. ä½¿ç”¨ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºæ¥å¤„ç† ç‚¹èµ å’Œ è¸©
   - ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå°±éœ€è¦åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œæ¥**åŒºåˆ†**ç‚¹å‡»çš„æ˜¯ ç‚¹èµè¿˜æ˜¯è¸©

- å› ä¸ºç‚¹å‡»æŒ‰é’®åï¼Œä¹Ÿéœ€è¦ä¿®æ”¹çŠ¶æ€ï¼Œæ‰€ä»¥ï¼Œç‚¹èµå’Œè¸©è¿™ä¸ªåŠŸèƒ½ä¹Ÿéœ€è¦ç”¨åˆ° ã€å­ -> çˆ¶ã€‘ çš„é€šè®¯
  - çˆ¶ç»„ä»¶æä¾›ä¸€ä¸ªå‡½æ•°
  - å°†å‡½æ•°ä¼ é€’ç»™å­ç»„ä»¶
  - å­ç»„ä»¶é€šè¿‡ props æ¥æ”¶è¿™ä¸ªå‡½æ•°

```js
// äº‹ä»¶å¤„ç†ç¨‹åº
// type è¡¨ç¤ºï¼šç‚¹å‡»äº†å“ªä¸ªæŒ‰é’®ï¼Œå¦‚æœ like è¡¨ç¤ºï¼šç‚¹èµï¼Œå¦‚æœæ˜¯ hate è¡¨ç¤ºï¼šè¸©
// id è¡¨ç¤ºï¼šè¡¨ç¤ºç‚¹å‡»äº†å“ªä¸€é¡¹
const onLike = (type, id) => {}

// ç‚¹èµ
<span className={isLike ? 'like liked' : 'like'} onClick={() => onLike('like', id)}>
  <i className="icon" />
    <span>{like !== 0 && like}</span>
</span>

// è¸©
<span className={isHate ? 'hate hated' : 'hate'} onClick={() => onLike('hate', id)>
  <i className="icon" />
</span>
```

- onLike çš„åŸºç¡€é€»è¾‘
  1. é€šè¿‡ id å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯å½“å‰é¡¹
  2. å¦‚æœä¸æ˜¯å½“å‰é¡¹ï¼Œä¸éœ€è¦åšä»»ä½•å¤„ç†ï¼Œç›´æ¥è¿”å› item å³å¯
  3. å¦‚æœæ˜¯å½“å‰é¡¹ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡ä¸­å…ˆæ‹¿åˆ°åŸæ¥çš„æ•°æ®
  4. ç„¶åï¼Œå†å°†ä¿®æ”¹çš„æ•°æ®ä¹Ÿæ”¾åˆ°å¯¹è±¡ä¸­å³å¯
  5. å¦‚æœæ˜¯å½“å‰ç‚¹å‡»é¡¹ï¼Œè¿˜è¦åŒºåˆ†ç‚¹å‡»çš„æ˜¯ ğŸ‘ è¿˜æ˜¯ è¸©
     1. å¦‚æœ type æ˜¯ likeï¼Œæ­¤æ—¶ï¼Œå°±æ˜¯ç‚¹èµ
     2. å¦åˆ™ï¼Œå°±æ˜¯è¸©

```js
// ç‚¹èµå’Œè¸©
const onLike = (type, id) => {
  const newList = list.map(item => {
    // 1. é€šè¿‡ id å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯å½“å‰é¡¹
    // 2. å¦‚æœä¸æ˜¯å½“å‰é¡¹ï¼Œä¸éœ€è¦åšä»»ä½•å¤„ç†ï¼Œç›´æ¥è¿”å› item å³å¯
    if (item.id !== id) return item

    // 3. å¦‚æœæ˜¯å½“å‰é¡¹ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡ä¸­å…ˆæ‹¿åˆ°åŸæ¥çš„æ•°æ®
    // æ˜¯å½“å‰ç‚¹å‡»é¡¹
    // åŒºåˆ†ç‚¹èµå’Œè¸©
    if (type === 'like') {
      // ç‚¹èµ
    } else {
      // è¸©
    }

    // 4. ç„¶åï¼Œå†å°†ä¿®æ”¹çš„æ•°æ®ä¹Ÿæ”¾åˆ°å¯¹è±¡ä¸­å³å¯
    return {
      ...item
      // æ­¤å¤„ï¼Œå°±æ˜¯è¦ä¿®æ”¹çš„æ•°æ®
    }
  })

  setList(newList)
}
```

- ä¿®æ”¹æ•°æ®çš„æ“ä½œï¼š

```js
let { id: curId, like, isLike, isHate } = item
// å¦‚æœä¸æ˜¯å½“å‰ id ï¼Œæ­¤æ—¶ï¼Œä¸éœ€è¦å¤„ç†è¯¥æ•°æ®ï¼Œç›´æ¥è¿”å› item å³å¯
// ä¸æ˜¯å½“å‰ç‚¹å‡»é¡¹
if (curId !== id) return item

// æ˜¯å½“å‰ç‚¹å‡»é¡¹
// åŒºåˆ†ç‚¹èµå’Œè¸©
if (type === 'like') {
  // ç‚¹èµ
  
  // è¿™ä¸ªæ“ä½œï¼Œä»…ä»…æ˜¯ä¿®æ”¹äº† isLike å˜é‡çš„å€¼ï¼Œå¹¶æ²¡æœ‰ä¿®æ”¹ item.isLike çš„å€¼ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸æ˜¯ç›´æ¥ä¿®æ”¹å½“å‰çŠ¶æ€
  isLike = !isLike
  
  // ä¸æ¨èï¼š
  // è¿™ä¸ªæ“ä½œï¼Œæ‰æ˜¯ç›´æ¥ä¿®æ”¹å½“å‰çŠ¶æ€çš„å€¼ï¼ï¼ï¼
  // item.isLike = !item.isLike
} else {
  // è¸©
  isHate = !isHate
}

// å¦‚æœæ˜¯å½“å‰ idï¼Œæ­¤æ—¶ï¼Œä¿®æ”¹ç›¸åº”çš„çŠ¶æ€å€¼å³å¯
return {
  ...item,
  // æ­¤å¤„ï¼Œå°±æ˜¯è¦ä¿®æ”¹çš„æ•°æ®
  isLike,
  isHate
}
```

- ç‚¹èµå’Œè¸©çš„é¢å¤–çš„é€»è¾‘ï¼ˆ1ï¼‰
  - å› ä¸ºç‚¹èµå’Œè¸©ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæ˜¯é€‰ä¸­çš„
  - æ‰€ä»¥ï¼Œä¸ç®¡æ˜¯ç‚¹å‡» ç‚¹èµ è¿˜æ˜¯ç‚¹å‡» è¸©ï¼Œéƒ½è¦åˆ¤æ–­å¦å¤–ä¸€ä¸ªæ˜¯å¦é€‰ä¸­çš„ï¼Œå¦‚æœé€‰ä¸­äº†ï¼Œå°±å–æ¶ˆé€‰ä¸­ï¼›å¦åˆ™ï¼Œä¸åšå¤„ç†

```js
      if (type === 'like') {
        // ç‚¹èµ
        isLike = !isLike
        // ç‚¹èµçš„æ—¶å€™ï¼Œéœ€è¦é¢å¤–çš„åˆ¤æ–­ è¸© æœ‰æ²¡æœ‰é€‰ä¸­
        // å¦‚æœé€‰ä¸­äº†ï¼Œå°±è®© è¸© ä¸é€‰ä¸­
        // å¦‚æœæ²¡é€‰ä¸­ï¼Œä¸éœ€è¦å¤„ç†æˆ–è€…ç›´æ¥æŠŠå½“å‰å€¼ç»™å®ƒå³å¯
        isHate = isHate ? false : isHate
      } else {
        // è¸©
        isHate = !isHate
        // ç‚¹å‡»è¸©çš„æ—¶å€™ï¼Œéœ€è¦é¢å¤–çš„åˆ¤æ–­ ç‚¹èµ æœ‰æ²¡æœ‰é€‰ä¸­
        // å¦‚æœé€‰ä¸­äº†ï¼Œå°±è®© ç‚¹èµ ä¸é€‰ä¸­
        // å¦‚æœæ²¡æœ‰é€‰ä¸­ï¼Œä¸éœ€è¦å¤„ç†æˆ–è€…ç›´æ¥æŠŠå½“å‰å€¼ç»™å®ƒå³å¯
        isLike = isLike ? false : isLike
      }
```

- ç‚¹èµå’Œè¸©åŠŸèƒ½çš„å®Œæ•´å®ç°ï¼š

```js
// ç‚¹èµå’Œè¸©
  const onLike = (type, id) => {
    const newList = list.map(item => {
      let { id: curId, like, isLike, isHate } = item
      // å¦‚æœä¸æ˜¯å½“å‰ id ï¼Œæ­¤æ—¶ï¼Œä¸éœ€è¦å¤„ç†è¯¥æ•°æ®ï¼Œç›´æ¥è¿”å› item å³å¯
      // ä¸æ˜¯å½“å‰ç‚¹å‡»é¡¹
      if (curId !== id) return item

      // æ˜¯å½“å‰ç‚¹å‡»é¡¹
      // åŒºåˆ†ç‚¹èµå’Œè¸©
      if (type === 'like') {
        // æ³¨æ„ï¼šæ­¤å¤„æ‹¿åˆ°çš„ isLike åº”è¯¥æ˜¯å½“å‰å€¼ï¼Œè€Œä¸æ˜¯ ä¿®æ”¹åçš„å€¼
        //      æ‰€ä»¥ï¼Œä¸ºäº†é¿å…é”™è¯¯ï¼Œéœ€è¦å°† isLike = !isLike æ”¾åˆ°åé¢
        //      ä¹Ÿå°±æ˜¯ï¼Œå…ˆä½¿ç”¨ isLikeï¼Œåé¢å†ä¿®æ”¹ï¼Œè¿™æ ·åé¢çš„ä»£ç ï¼Œå°±ä¸ä¼šå½±å“å‰é¢äº†ï¼ï¼ï¼

        // ç‚¹èµæ—¶ï¼Œåˆ¤æ–­å½“å‰æ˜¯å¦é€‰ä¸­ï¼Œæ¥æ§åˆ¶ç‚¹èµæ•°
        // å¦‚æœå½“å‰æ˜¯é€‰ä¸­çš„ï¼Œå†ç‚¹å‡»ï¼Œå°±æ˜¯ä¸é€‰ä¸­ï¼Œå¹¶ä¸”ï¼Œè¦è®©ç‚¹èµæ•° - 1
        // å¦‚æœå½“å‰æ˜¯æœªé€‰ä¸­çš„ï¼Œå†ç‚¹å‡»ï¼Œå°±æ˜¯é€‰ä¸­ï¼Œå¹¶ä¸”ï¼Œè¦è®©ç‚¹èµæ•° + 1
        like = isLike ? like - 1 : like + 1
        // ç‚¹èµçš„æ—¶å€™ï¼Œéœ€è¦é¢å¤–çš„åˆ¤æ–­ è¸© æœ‰æ²¡æœ‰é€‰ä¸­
        // å¦‚æœé€‰ä¸­äº†ï¼Œå°±è®© è¸© ä¸é€‰ä¸­
        // å¦‚æœæ²¡é€‰ä¸­ï¼Œä¸éœ€è¦å¤„ç†æˆ–è€…ç›´æ¥æŠŠå½“å‰å€¼ç»™å®ƒå³å¯
        isHate = isHate ? false : isHate
        // ç‚¹èµ
        isLike = !isLike
      } else {
        // åœ¨ç‚¹å‡»è¸©çš„æ—¶å€™ï¼Œåˆ¤æ–­ç‚¹èµæ˜¯å¦é€‰ä¸­
        // å¦‚æœç‚¹èµä¸é€‰ä¸­ï¼Œä¸åšä»»ä½•å¤„ç†
        // å¦‚æœç‚¹èµé€‰ä¸­ï¼Œå°±è®©ç‚¹èµæ•° - 1ï¼Œå¹¶ä¸”å–æ¶ˆç‚¹èµçš„é€‰ä¸­ï¼ˆé€‰ä¸­å·²ç»å¤„ç†è¿‡ï¼‰
        like = isLike ? like - 1 : like

        // è¸©
        isHate = !isHate
        // ç‚¹å‡»è¸©çš„æ—¶å€™ï¼Œéœ€è¦é¢å¤–çš„åˆ¤æ–­ ç‚¹èµ æœ‰æ²¡æœ‰é€‰ä¸­
        // å¦‚æœé€‰ä¸­äº†ï¼Œå°±è®© ç‚¹èµ ä¸é€‰ä¸­
        // å¦‚æœæ²¡æœ‰é€‰ä¸­ï¼Œä¸éœ€è¦å¤„ç†æˆ–è€…ç›´æ¥æŠŠå½“å‰å€¼ç»™å®ƒå³å¯
        isLike = isLike ? false : isLike
      }

      // å¦‚æœæ˜¯å½“å‰ idï¼Œæ­¤æ—¶ï¼Œä¿®æ”¹ç›¸åº”çš„çŠ¶æ€å€¼å³å¯
      return {
        ...item,
        // æ­¤å¤„ï¼Œå°±æ˜¯è¦ä¿®æ”¹çš„æ•°æ®
        isLike,
        isHate,
        like
      }
    })

    setList(newList)
  }
```

### ä½¿ç”¨æœ¬åœ°ç¼“å­˜å­˜å‚¨æ•°æ®

éœ€æ±‚ï¼šå°†è¯„è®ºæ•°æ®ï¼Œå­˜å‚¨åˆ°æœ¬åœ°ç¼“å­˜ï¼ˆ`localStorage`ï¼‰ï¼Œè¿›å…¥é¡µé¢æ—¶ï¼Œä»æœ¬åœ°ç¼“å­˜ä¸­ï¼Œå–å‡ºä¸Šä¸€æ¬¡å­˜å‚¨çš„æ•°æ®

é€šè¿‡åˆ†æï¼Œå‘ç°æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µéœ€è¦å­˜å‚¨æ•°æ®ï¼š

1. å‘è¡¨è¯„è®º
2. ç‚¹èµå’Œè¸©

è€Œå®é™…ä¸Šï¼Œä¸ç®¡æ˜¯å‘è¡¨è¯„è®ºè¿˜æ˜¯ç‚¹èµå’Œè¸©ï¼Œéƒ½ä¼šä¿®æ”¹çŠ¶æ€`list`ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ list çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ¥å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ç¼“å­˜ä¸­å³å¯

```js
// å‰¯ä½œç”¨çš„ä»£ç ï¼Œéƒ½éœ€è¦æ”¾åœ¨ useEffect è¿™ä¸ª hook ä¸­
useEffect(() => {
  // å‰¯ä½œç”¨ä»£ç 
  localStorage.setItem('comments', JSON.stringify(list))
}, [list])
```

åœ¨è¿›å…¥é¡µé¢æ—¶ï¼Œéœ€è¦ä»æœ¬åœ°ç¼“å­˜ä¸­å–å‡ºä¸Šä¸€æ¬¡å­˜å‚¨çš„æ•°æ®ï¼Œ

1. å¦‚æœæœ¬åœ°ç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„æ•°æ®
2. å¦‚æœæœ¬åœ°ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°±ç”¨ comments é»˜è®¤å€¼

```js
const [list, setList] = useState( JSON.parse(localStorage.getItem('comments')) || comments )
```

## useState çš„å›è°ƒå‡½æ•°å‚æ•°

useState çš„å‚æ•°å¯ä»¥æœ‰ä¸¤ç§å½¢å¼ï¼š

1. `useState(æ™®é€šçš„æ•°æ®)` => useState(false) / useState('')
2. `useState(å›è°ƒå‡½æ•°)` => useState(() => { return åˆå§‹å€¼ })
   1. å›è°ƒå‡½æ•°çš„è¿”å›å€¼å°±æ˜¯çŠ¶æ€çš„åˆå§‹å€¼
   2. è¯¥å›è°ƒå‡½æ•°åªä¼šè§¦å‘ä¸€æ¬¡

```js
  // ä½¿ç”¨ å›è°ƒå‡½æ•° æ¥ä¸º useState åˆå§‹åŒ–é»˜è®¤å€¼
  // å›è°ƒå‡½æ•°çš„è¿”å›å€¼å°±æ˜¯çŠ¶æ€çš„åˆå§‹å€¼ï¼
  // æ³¨æ„ï¼šè¯¥å›è°ƒå‡½æ•°åªä¼šè§¦å‘ä¸€æ¬¡
  const [list, setList] = useState(() => {
    return JSON.parse(localStorage.getItem('comments')) || comments
  })
```

- è¯¥ä½¿ç”¨å“ªç§å½¢å¼ï¼Ÿ
  1. å¦‚æœçŠ¶æ€å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°æ®ï¼ˆæ¯”å¦‚ï¼Œå­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ç­‰ï¼‰éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ `useState(æ™®é€šçš„æ•°æ®)`
  2. å¦‚æœçŠ¶æ€æ˜¯ç»è¿‡ä¸€äº›è®¡ç®—å¾—åˆ°çš„ï¼Œæ­¤æ—¶ï¼Œæ¨èä½¿ç”¨ `useState(å›è°ƒå‡½æ•°)`

```js
// ç¬¬ä¸€ç§ï¼š
const [list, setList] = useState(
  JSON.parse(localStorage.getItem('comments')) || comments
)
// å¯ä»¥è½¬åŒ–ä¸ºï¼š
// è¿™ç§æƒ…å†µä¸‹ï¼Œåªè¦ç»„ä»¶æ›´æ–°ï¼Œæ­¤å¤„çš„ localStorage ç­‰æ“ä½œå°±ä¼šé‡å¤æ‰§è¡Œ
const initList = JSON.parse(localStorage.getItem('comments')) || comments
const [list, setList] = useState(initList)

// ç¬¬äºŒç§ï¼š
// è¿™ç§æ–¹å¼ï¼Œå› ä¸ºå›è°ƒå‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥ï¼Œæ­¤å¤„çš„ localStorage ç­‰æ“ä½œä»£ç åªä¼šæ‰§è¡Œä¸€æ¬¡
const [list, setList] = useState(() => {
  return JSON.parse(localStorage.getItem('comments')) || comments
})

// åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼
```















